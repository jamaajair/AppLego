package org.spftech.backend;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;

import org.spftech.backend.entity.Dossier;
import org.spftech.backend.entity.Party.Party;
import org.spftech.backend.entity.DossierRelatedParty;
import org.spftech.backend.repository.DossierRepository;
import org.spftech.backend.repository.PartyRepository;
import org.spftech.backend.repository.DossierRelatedPartyRepository;

import static org.assertj.core.api.Assertions.assertThat;

@DataJpaTest
public class DossierRelatedPartyRepositoryTest {

    @Autowired
    private DossierRepository dossierRepository;

    @Autowired
    private PartyRepository partyRepository;

    @Autowired
    private DossierRelatedPartyRepository dossierRelatedPartyRepository;

    @Test
    public void testCreateDossierRelatedParty() {
        Dossier dossier = new Dossier();
        dossier.setLabel("Jair dossier");
        dossierRepository.save(dossier);

        Party party = new Party();
        party.setLabel("Jamaa JAIR");
        partyRepository.save(party);

        DossierRelatedParty link = new DossierRelatedParty();
        link.setDossier(dossier);
        link.setParty(party);

        dossierRelatedPartyRepository.save(link);

        // check 
        var all = dossierRelatedPartyRepository.findAll();
        assertThat(all).hasSize(1);
        assertThat(all.get(0).getParty().getLabel()).isEqualTo("Jamaa JAIR");
        assertThat(all.get(0).getDossier().getLabel()).isEqualTo("Jair dossier");
    }
}
